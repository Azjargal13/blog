<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue 清除定时器 | 雨无声</title>
    <meta name="description" content="安全的清除 vue 中的定时器">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/styles.c093fd91.css" as="style"><link rel="preload" href="/assets/js/app.c093fd91.js" as="script"><link rel="preload" href="/assets/js/30.16141173.js" as="script"><link rel="prefetch" href="/assets/css/1.styles.3cf9f0cb.css"><link rel="prefetch" href="/assets/css/2.styles.c7efada8.css"><link rel="prefetch" href="/assets/css/3.styles.a7e01bf9.css"><link rel="prefetch" href="/assets/css/4.styles.46a5109f.css"><link rel="prefetch" href="/assets/css/5.styles.7f589661.css"><link rel="prefetch" href="/assets/css/6.styles.a06b2402.css"><link rel="prefetch" href="/assets/css/7.styles.53ec83ac.css"><link rel="prefetch" href="/assets/css/8.styles.a2c935fe.css"><link rel="prefetch" href="/assets/css/9.styles.e48ef3e3.css"><link rel="prefetch" href="/assets/js/1.3cf9f0cb.js"><link rel="prefetch" href="/assets/js/10.10a6d618.js"><link rel="prefetch" href="/assets/js/11.2db0bf0f.js"><link rel="prefetch" href="/assets/js/12.21c29ea7.js"><link rel="prefetch" href="/assets/js/13.e09044d3.js"><link rel="prefetch" href="/assets/js/14.2f4f7c24.js"><link rel="prefetch" href="/assets/js/15.6f9bfa04.js"><link rel="prefetch" href="/assets/js/16.a829fe77.js"><link rel="prefetch" href="/assets/js/17.596ccb4f.js"><link rel="prefetch" href="/assets/js/18.fdd8de4d.js"><link rel="prefetch" href="/assets/js/19.c2744711.js"><link rel="prefetch" href="/assets/js/2.c7efada8.js"><link rel="prefetch" href="/assets/js/20.5630ee64.js"><link rel="prefetch" href="/assets/js/21.ca600525.js"><link rel="prefetch" href="/assets/js/22.abfab4dd.js"><link rel="prefetch" href="/assets/js/23.881ce416.js"><link rel="prefetch" href="/assets/js/24.c6920439.js"><link rel="prefetch" href="/assets/js/25.cdf3b212.js"><link rel="prefetch" href="/assets/js/26.cade8387.js"><link rel="prefetch" href="/assets/js/27.16f702d6.js"><link rel="prefetch" href="/assets/js/28.06a1b451.js"><link rel="prefetch" href="/assets/js/29.cc36d51d.js"><link rel="prefetch" href="/assets/js/3.a7e01bf9.js"><link rel="prefetch" href="/assets/js/31.6c27106e.js"><link rel="prefetch" href="/assets/js/32.18f21d86.js"><link rel="prefetch" href="/assets/js/33.7ac61928.js"><link rel="prefetch" href="/assets/js/34.b639515d.js"><link rel="prefetch" href="/assets/js/35.6e605ba2.js"><link rel="prefetch" href="/assets/js/36.3aa5900b.js"><link rel="prefetch" href="/assets/js/4.46a5109f.js"><link rel="prefetch" href="/assets/js/5.7f589661.js"><link rel="prefetch" href="/assets/js/6.a06b2402.js"><link rel="prefetch" href="/assets/js/7.53ec83ac.js"><link rel="prefetch" href="/assets/js/8.a2c935fe.js"><link rel="prefetch" href="/assets/js/9.e48ef3e3.js">
    <link rel="stylesheet" href="/assets/css/1.styles.3cf9f0cb.css"><link rel="stylesheet" href="/assets/css/2.styles.c7efada8.css"><link rel="stylesheet" href="/assets/css/3.styles.a7e01bf9.css"><link rel="stylesheet" href="/assets/css/4.styles.46a5109f.css"><link rel="stylesheet" href="/assets/css/5.styles.7f589661.css"><link rel="stylesheet" href="/assets/css/6.styles.a06b2402.css"><link rel="stylesheet" href="/assets/css/7.styles.53ec83ac.css"><link rel="stylesheet" href="/assets/css/8.styles.a2c935fe.css"><link rel="stylesheet" href="/assets/css/9.styles.e48ef3e3.css"><link rel="stylesheet" href="/assets/css/styles.c093fd91.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="site-wrapper"><header blog="[object Object]" class="site-header outer 333 no-cover"><div class="inner"><!----> <nav class="site-nav"><div class="site-nav-left"><!----> <a href="/" class="site-nav-logo router-link-active">
      
    </a> <ul class="nav"></ul></div> <div class="site-nav-right"><div class="social-links"></div></div></nav></div></header> <main id="site-main" class="site-main outer"><div class="inner"><article class="post-full no-image"><header class="post-full-header"><h1 class="post-full-title"></h1></header> <!----> <section class="post-full-content"><div class="content custom post-content"><p>由于是单页面，在页面切换后，定时器没有被清除，在再次回到页面时，使得两个定时器同时工作，时间流逝加倍。使用 beforeDestroy() 来清除定时器</p> <p>所需要做的就是在页面销毁之前将可能没用完成的定时器清除，大致代码如下</p> <div class="language-html vue extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ time }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>buttom</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>start()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>start<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>buttom</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">{</span>
      time<span class="token punctuation">:</span> <span class="token number">60</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">start</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      	  <span class="token keyword">this</span><span class="token punctuation">.</span>time<span class="token operator">--</span><span class="token punctuation">;</span>
      	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      	  <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
          timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$once</span><span class="token punctuation">(</span><span class="token string">'hook:beforeDestroy'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      	<span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// beforeDestroy 在销毁前将页面的定时器清除</span>
  <span class="token function">beforeDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></div></section></article></div></main> <footer class="site-footer outer"><div class="site-footer-content inner"><section class="copyright"><a href="/"></a> © 2019</section> <nav class="site-footer-nav"></nav></div></footer></div></div>
    <script src="/assets/js/30.16141173.js" defer></script><script src="/assets/js/app.c093fd91.js" defer></script>
  </body>
</html>
